<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<title>判決書 Parser</title>
<script src="//ajax.googleapis.com/ajax/libs/jquery/1.8.3/jquery.min.js"></script>
</head>
<body>
<form method="get" id="form">
    URL: <input type="text" size="100" id="url" placeholder="請貼上判決的單一判決頁、友善列印頁(推薦)網址">
    <button type="submit">GET</button>
</form>
<div id="message"></div>
分享網址: <input type="text" readonly="readonly" id="share-url" size="90">
<div id="wiki-area">
Wiki Infobox:
<textarea style="width:100%; height: 300px" id="wiki"></textarea>
</div>
Result:
<textarea style="width:100%; height: 500px" id="textarea"></textarea>
<script src="judge_parse.js"></script>
<script>
$('#form').submit(function(e){
        e.preventDefault();
        var url = $('#url').val();
        var proxy_url = 'http://proxy.g0v.ronny.tw/proxy.php?url=' + encodeURIComponent(url);

        if (url.match('/FJUD/FJUDQRY03_1.aspx')) { // 單一判決頁
            var type = 'FJUDQRY03_1';
        } else if (url.match(/^(.*法院)(刑事|民事|行政訴訟)(判決|裁定)/)) {
            var matches = url.match(/^(.*法院)(刑事|民事|行政訴訟)(判決|裁定).*?([0-9]*)年度(.*)字第([0-9]*)號/);
            var court_id = court_name[matches[1]];
            var court_type = getCaseType(matches[2]);
            var year = parseInt(matches[4], 10);
            var case_word = matches[5];
            var case_no = matches[6];
            $('#share-url').val('http://jirs.judicial.gov.tw/FJUD/FJUDQRY02_1.aspx?cw=1&v_court=' + encodeURIComponent(court_id + ' ' + court[court_id]) + '&v_sys=' + court_type + '&jud_year=' + year + '&jud_case=' + encodeURIComponent(case_word) + '&jud_no=' + case_no + '&jud_title=&keyword=&sdate=19110101&edate=99991231&searchkw=');
            $('#message').text('已產生可分享此案件連結，詳細資訊可入內透過友善列印取出');
            return;
        } else if (url.match('/FJUD/PrintFJUD03_0.aspx')) { // 友善列印頁
            var type = 'PrintFJUD03_0';
        } else if (url.match('/FJUD/HISTORYSELF.aspx')) { // 歷審頁
            var type = 'HISTORYSELF';
        } else {
            $('#message').text('目前只允許處理單一判決頁、友善列印頁或是歷審案件查詢頁');
            return;
        }
        
        $('#message').text('讀取中...');
        $.get(proxy_url, function(text){
            var result;
            $('#message').text('');
            if ('FJUDQRY03_1' == type) {
                result = parse_from_page(text);
            } else if ('PrintFJUD03_0' == type) {
                result = parse_from_print_page(text, url);
            } else if ('HISTORYSELF' == type) {
                result = parse_history(text);
                $('#textarea').text(JSON.stringify(result, true, 2));
                $('#wiki-area').hide();
                return;
            }
            $('#textarea').text(JSON.stringify(result, true, 2));
            $('#wiki-area').show();
            $('#wiki').text(to_wiki_infobox(result));
            $('#share-url').val(result["連結"]["列表"]);
        });
});
</script>
</body>
</html>
